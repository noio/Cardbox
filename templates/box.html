{% extends "base.html" %}

{% block content %}
    <div class="span-24 last">
        {% if box.is_saved %}
        <form action="{% url cardbox.views.box_edit box.key.id %}" method="post">
        {% else %}
        <form action="{% url cardbox.views.box_create %}" method="post">
        {% endif %}
            <h3><span class='faded'/>Editing your box: <input class='title' id="id_title" type="text" value="{{box.title}}" name="title"></h3>
            <input id="id_cardsets" type="hidden" value='{{box.cardsets|join:","}}' name='cardsets'>
            <h3>Selected sets:</h3> 
            <p>The following sets are currently in this box. Click remove to remove them. Your studying progress for a set
                will be lost 30 days after you it from the box, unless you add it again in the meantime.</p>
            <div class='span-24' id='browser_selected'>
            </div>
            <h3>Available sets:</h3>
            <p>Select the sets you want to study from the list below.</p>
            <div class='span-24' id='browser_available'>
            </div>
            <script>
                selectedBrowser = new BrowseTable('browser_selected',{
                    {%if box.is_saved%}'filters':{'ids':'{{box.cardsets|join:","}}' },{%endif%}
                    'kind':'cardset',
                    'actions':['remove']
                });
                selectedBrowser.addEvent('action_remove',function(id){
                    selectedBrowser.removeRow(id);
                    $('id_cardsets').set('value',selectedBrowser.getRowIds().join(','));
                });
                {%if box.is_saved %}selectedBrowser.refresh();{% endif %}
                availableBrowser=new BrowseTable('browser_available',{
                    'kind':'cardset',
                    'actions':['add']
                });
                availableBrowser.addEvent('action_add',function(id){
                    selectedBrowser.addRow(availableBrowser.getRowData(id));
                    $('id_cardsets').set('value',selectedBrowser.getRowIds().join(','));
                });
                availableBrowser.refresh();
            </script>
            
            <p><input type="submit" value="Save Changes"/></p>
        </form>
    </div>
{% endblock %}