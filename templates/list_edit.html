{% extends "base.html" %}

{% load cardbox_filters %}

{% block content %}
    <div class="span-24">
        {% if list.is_saved %}
        <form id='list-edit-form' action="{% url cardbox.views.list_edit name=list.name %}" method="post">
        <div class='page-head'>
            <span class='item-icon list'></span>
            <h3></span><span class='faded'>Editing list: </span></h3> <input class='title' name='title' type='text' value='{{list.title}}'>
        {% else %}
        <form id='list-edit-form' action="{% url cardbox.views.list_create %}" method="post">
        <div class='page-head'>
            <span class='item-icon list'></span>
            <h3><span class='faded'>Creating a list named: </span></h3> <input class='title' name='title' type='text' value='{{page.title}}'>
        {% endif %}
            <div class='button-bar standalone'><ul>
                {% if list.is_saved %}<li><a class='button-cancel' href='{% url cardbox.views.list_view name=list.name %}'><span class='icon'></span>Cancel</a></li>{%endif%}
                <li><a class='button-save' href='#' onClick='$("list-edit-form").submit()'><span class='icon'></span>Save Changes</a></li>
            </ul></div>
        </div>
   
        <table class='list-view'>
            {% for k in list.columns %}<col/>{% endfor %}
            <thead>
                <tr>
                    {% for k in list.columns %}
                    <th>{{k}}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
            {% for row_id in list.row_order %}
            {% with list.rows|dictkey:row_id as row %}
            <tr>
                {% for c in list.columns %}
                <td>{{row|dictkey:c}}</td>
                {% endfor %}
            </tr>
            {% endwith %}
            {% endfor %}
            </tbody>
        </table>
        
        
        <div class='span-24'>
            {% for cardset in list.cardset_set %}
            <div class='cardset-editor'>
                <input type='text' name='title' value='{{cardset.title}}'>
                <input type='text' name='template' value='{{cardset.template}}'>
                <input type='hidden' name='cardset-id' value='{{cardset.key.id}}'>
                <input type='hidden' name='cardset-mapping' value='{{cardset.mapping_json}}'>
                <input type='hidden' name='cardset-id' value='{{cardset.key.id}}'>
                <div class='splitview'>{{cardset.sample}}</div>
            <div>
            {% endfor %}
            
            <input type='hidden' name='cardset-id' value='4'>
            <input type='hidden' name='cardset-id' value='5'>
            <input type='hidden' name='cardset-id' value='6'>
            
        <div>
            
        <script type='text/javascript'>
            window.listEditor = new ListEditor('list-edit-form');
        </script>
        
        </form>
    </div>
{% endblock %}